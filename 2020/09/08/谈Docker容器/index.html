<!DOCTYPE html>
<html lang="en">

<!-- Head tag -->
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="google-site-verification" content="xBT4GhYoi5qRD5tr338pgPM5OWHHIDR6mNg1a3euekI" />
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="description" content="">
    <meta name="keyword"  content="">
    <link rel="shortcut icon" href="/img/ironman-draw.png">
    <!-- Place this tag in your head or just before your close body tag. -->
    <script async defer src="https://buttons.github.io/buttons.js"></script>
    <script async src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js">
</script>
    <title>
        
          谈Docker容器 - null
        
    </title>

    <link rel="canonical" href="http://damonyi.cc/2020/09/08/谈Docker容器/">

    <!-- Bootstrap Core CSS -->

   
<link rel="stylesheet" href="https://cdn.staticfile.org/twitter-bootstrap/3.4.1/css/bootstrap.min.css">


    

    <!-- Custom CSS --> 
    
<link rel="stylesheet" href="/css/beantech.min.css">


    
<link rel="stylesheet" href="/css/donate.css">

	
<link rel="stylesheet" href="/css/w3.css">

    <!-- Pygments Highlight CSS -->
    
<link rel="stylesheet" href="/css/highlight.css">


    
<link rel="stylesheet" href="/css/widget.css">


    
<link rel="stylesheet" href="/css/rocket.css">


    
<link rel="stylesheet" href="/css/signature.css">


    
<link rel="stylesheet" href="/css/toc.css">


    <!-- Custom Fonts -->
    <!-- <link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.3.0/css/font-awesome.min.css" rel="stylesheet" type="text/css"> -->
    <!-- Hux change font-awesome CDN to qiniu -->
    <link href="https://cdn.staticfile.org/font-awesome/4.5.0/css/font-awesome.min.css" rel="stylesheet" type="text/css">


    <!-- Hux Delete, sad but pending in China
    <link href='http://fonts.googleapis.com/css?family=Lora:400,700,400italic,700italic' rel='stylesheet' type='text/css'>
    <link href='http://fonts.googleapis.com/css?family=Open+Sans:300italic,400italic,600italic,700italic,800italic,400,300,600,700,800' rel='stylesheet' type='text/
    css'>
    -->


    <!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 9]>
        <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
        <script src="https://oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></script>
    <![endif]-->
	

    <!-- ga & ba script hoook -->
    <script></script>
<meta name="generator" content="Hexo 5.1.1"></head>


<!-- hack iOS CSS :active style -->
<body ontouchstart="">
	<!-- Modified by Yu-Hsuan Yen -->
<!-- Post Header -->
<style type="text/css">
    header.intro-header{
    }
   .post-heading{
    padding:20px;
    }
  .person {
    border: 10px solid transparent;
    margin-bottom: 25px;
    width: 80%;
    height: 80%;
    opacity: 0.7;
  }
  .person:hover {
    border-color: #f1f1f1;
  }

</style>

<header id="headerid" class="w3-indigo intro-header" style="position:relative;">
    <!-- Signature -->
	
        <div class="container">
            <div class=" row" >
			
			<canvas id="particles-js-canvas" style="position:absolute;z-index:1;top:0px;left:0px;" width="100%" height="50%"></canvas>
			
                <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1" style="z-index:2;">
                
                    <div class="post-heading" style="padding:40px">
                        <div class="tags">
                            
                        </div>
                        <h1>谈Docker容器</h1>
                        <h2 class="subheading"></h2>
                        <span class="meta">
                            Posted by 站着工程师 on
                            2020-09-08
                        </span>
                        <span  class="meta" id="busuanzi_container_page_pv">
                                本文总阅读量<span id="busuanzi_value_page_pv"></span>次
                         </span>
                    </div>
                
                </div>
            </div>
        </div>
  
</header>

	
    <!-- Navigation -->
<nav class="navbar navbar-default navbar-custom navbar-fixed-top">
    <div class="container-fluid">
        <!-- Brand and toggle get grouped for better mobile display -->
        <div class="navbar-header page-scroll">
            <button type="button" class="navbar-toggle">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>
            <a class="navbar-brand" href="/">云里雾里</a>
        </div>

        <!-- Collect the nav links, forms, and other content for toggling -->
        <!-- Known Issue, found by Hux:
            <nav>'s height woule be hold on by its content.
            so, when navbar scale out, the <nav> will cover tags.
            also mask any touch event of tags, unfortunately.
        -->
        <div id="huxblog_navbar">
            <div class="navbar-collapse">
                <ul class="nav navbar-nav navbar-right">
                    <li>
                        <a  href="/">主页</a>
                    </li>
		    
                    

                        
                        <li>
           
                            <a  href="#技术">技术</a>
                           
                        </li>
                        
                    

                        
                        <li>
           
                            <a  href="#教育">教育</a>
                           
                        </li>
                        
                    
                    
                </ul>
            </div>
        </div>
        <!-- /.navbar-collapse -->
    </div>
    <!-- /.container -->
</nav>
<script>
    // Drop Bootstarp low-performance Navbar
    // Use customize navbar with high-quality material design animation
    // in high-perf jank-free CSS3 implementation
    var $body   = document.body;
    var $toggle = document.querySelector('.navbar-toggle');
    var $navbar = document.querySelector('#huxblog_navbar');
    var $collapse = document.querySelector('.navbar-collapse');

    $toggle.addEventListener('click', handleMagic)
    function handleMagic(e){
        if ($navbar.className.indexOf('in') > 0) {
        // CLOSE
            $navbar.className = " ";
            // wait until animation end.
            setTimeout(function(){
                // prevent frequently toggle
                if($navbar.className.indexOf('in') < 0) {
                    $collapse.style.height = "0px"
                }
            },400)
        }else{
        // OPEN
            $collapse.style.height = "auto"
            $navbar.className += " in";
        }
    }
</script>


    <!-- Main Content -->
    <!-- Modify by Yu-Hsuan Yen -->

<!-- Post Content -->
<article>
    <div class="container">
        <div class="row">

            <!-- Post Container -->
            <div class="
                col-lg-8 col-lg-offset-2
                col-md-10 col-md-offset-1
                post-container">

                <p>##什么是容器<br>  在云计算或者说虚拟机普及的过程中，用户常常会问虚拟机是什么？虚拟机有什么优势？性能如何？她是如何提高硬件利用率？。。。当然我们会给客户解释CPU与内存虚拟化、资源超分配、分布式存储等等概念。到现在，虚拟机完全被普及，虚拟机带来的优势适合诸多业务场景，逐渐打消了人们对虚拟机的各种疑虑。那么，被不少激进的IT人宣称的，会替代虚拟机的容器又是什么呢？<br>   网上许多关于容器的介绍都是针对Docker，其实容器并不是Docker，Docker只是容器技术的一种实现，或者说是就是把容器的管理以命令行的方式呈现出来。之前有个老外写了篇100行Golang代码实现容器（<a target="_blank" rel="noopener" href="https://www.infoq.com/articles/build-a-container-golang%EF%BC%89%EF%BC%8C">https://www.infoq.com/articles/build-a-container-golang），</a><br>   基于这个代码实现的容器，更能体现容器技术的本质，容器的核心应该是三个方面：</p>
<ol>
<li>命名空间：隔离，容器内的应用只能看到该容器内的资源（用户信息、进程信息，网络信息、挂载信息等）</li>
<li>Cgroup：为不同的容器提供资源限制，定义容器对宿主机资源（CPU、内存等）的最大使用量。</li>
<li>分层文件系统：基于写时复制(COW)、联合挂载的文件系统，为容器提供文件系统<br>再来看一下，以Docker（Moby）为代表的容器，官方的描述：   <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">A container image is a lightweight, stand-alone, executable package of a piece of software that includes everything needed to run it: code, runtime, system tools, system libraries, settings. Available for both Linux and Windows based apps, containerized software will always run the same, regardless of the environment. Containers isolate software from its surroundings, for example differences between development and staging environments and help reduce conflicts between teams running different software on the same infrastructure.</span><br></pre></td></tr></table></figure>
翻译一下：<br><br> &nbsp;&nbsp;  容器镜像是一个轻量级、独立、可执行软件的打包，这个包内包含了需要运行该软件的代码、运行环境、系统工具、系统库、配置。基于Linux和Windows的应用，容器化后的软件可以运行在windows或者Linux，无需感知环境的变化。容器将软件与其他不想关的资源隔离，例如不区分开发环境、演示环境，减少不同团队在相同基础环境运行不同软件带来的冲突<br>##容器与镜像</li>
</ol>
<p>参考下面最经典的Docker技术架构图。 <br><br><img src="/2020/09/08/%E8%B0%88Docker%E5%AE%B9%E5%99%A8/docker.png" alt="BP"></p>
<p>###按照这幅图上的3个命令梳理一下</p>
<ol>
<li><p>docker build<br>如前文所说，Docker只是把容器管理以命令行的方式呈现，Docker对容器生态最大的贡献是他的镜像（Image）<br><br>容器镜像可以认为一个应用+运行环境的模板，和虚拟机模板类似，但是与虚拟机模板不同的是：这个镜像一般比较小，通常只是包含应用的执行文件以及特定的运行环境，不会包含操作系统的文件，制作镜像是需要定义一个描述镜像内容的描述文件就OK了，Docker里面叫做Dockerfile，不会像虚拟机模板那样，需要在虚拟化环境上进行一次操作系统安装，<br><br>镜像是平台无关的，平台无关就是制作了一次镜像，可以运行在windows、linux、阿里云、Vmware、华为云等等，不像虚拟机，你在阿里云上制作的虚拟机模板只能在阿里云使用，在AWS上制作的虚拟机模板只能在AWS使用。容器镜像的平台无关性是容器发展迅速的重要原因，这个特性解放了应用开发商与服务开发商，也让平台提供商有了新的发展方向。<br><br>回到这条命令上来，通常我们执行docker build 是需要编写Dockerfile文件，如下所示，是制作大数据Ambari Server镜像的Dockerfile文件</p>
<p><img src="/2020/09/08/%E8%B0%88Docker%E5%AE%B9%E5%99%A8/dockerfile.png" alt="avatar"></p>
<p><br>当定义了这个Dockerfile后，在命令行执行</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">   docker build . -t ambari-server:1.0</span><br><span class="line">&#96;&#96;&#96;&#96;  </span><br><span class="line">&amp;nbsp;&amp;nbsp; 就可以获取到我们制作的容器镜像了，制作完成后，只是放在了本地机器上了，需要执行一个命令</span><br></pre></td></tr></table></figure>
<p>docker push  ambari-server:1.0 </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">将镜像保存到镜像仓库（registry），这样其他主机才能使用到该镜像</span><br><span class="line"></span><br><span class="line">  2. docker pull</span><br><span class="line">    </span><br><span class="line">   这个命令就是在主机上将容器镜像从镜像仓库下载下来，实现了镜像的远程获取、分发能力。这个镜像下载并不是全量下载，而是只是把该主机上缺少的镜像下载下来，这里就涉及到容器镜像的分层特性，这里就不展开说了。</span><br><span class="line">     </span><br><span class="line">  3. docker run：</span><br><span class="line"></span><br><span class="line">那么容器是如何从镜像变为容器呢，我们只需要执行docker run 命令</span><br></pre></td></tr></table></figure>
<p>docker run -itd  ambari-server:1.0  bash</p>
<pre><code>执行这个命令后，
1、Docker 会在宿主机上分配一个目录，将镜像的文件挂载到这个目录2  &lt;br /&gt;
2、Docker会在Docker Daemon进程上fork出一个子进程，这个子进程是命名空间隔离的，你在容器内看不到宿主机的信息  &lt;br /&gt;
3、Docker会为这个容器分配IP地址  &lt;br /&gt;
</code></pre>
</li>
</ol>
<p>登录到这个容器后，你看到的进程信息和网络信息如下<br> <img src="/2020/09/08/%E8%B0%88Docker%E5%AE%B9%E5%99%A8/net1.png" alt="avatar"></p>
<p><img src="/2020/09/08/%E8%B0%88Docker%E5%AE%B9%E5%99%A8/net2.png" alt="avatar"></p>
<p>##容器与应用</p>
<p>   虚拟机强调资源的分配的管理，而容器更强调对应用的管理，随着容器的出现，容器逐渐开始影响软件架构。与虚拟机相比，容器有哪些优势？可以看下表的对比分析<br>    上表的对比一般都是各个容器厂商的宣传卖点，容器为应用真正带来了哪些？或者说应用的哪些需求推动了容器的普及？<br>###应用部署<br>   容器为应用部署带来的变化主要体现在开发环境、测试环境、生产环境的一致性上，依赖于Docker的镜像，在应用开发完成后，架构师就可以定义应用的镜像，这个镜像里面包含了应用的运行环境（Tomcat、JDK、Nginx等），也包含了应用的可执行文件（War文件、Jar文件等），将之前需要在项目现场做的工作交由最熟悉的架构师完成，交付人员在项目现场只需要执行一个简单的docker run命令就可以了。<br>###应用迁移<br>   将应用部署在虚拟机时，应用迁移一般有两种方式<br>   a.将应用所在的虚拟机以虚拟机模板的方式导出，如果是跨云的话，还需要做虚拟机模板的格式转化，将虚拟机模板再导入到另一个云环境,然后再去修改各种参数配置<br>   <br>b.虚拟机模板格式无法转化（例如从AWS迁移到阿里云），这时只能重新部署了。<br>      如果你使用容器转载你的应用，既不会存在这样的问题了，容器镜像与容器技术属于平台无关性，只要把镜像复制过去，然后启动容器就OK了。<br>###应用升级：<br>  应用升级对于复杂的系统是个很棘手的事情，升级前需要做备份，升级失败要做恢复，有了容器就简单多了，停掉旧版本的容器，启动新版本的容器，升级失败，只需要停掉新版本容器，启动旧版本容器就可以了。<br>       在IT领域，最重要的就是应用，或者说一个新的名词-SAAS，无论云计算、大数据还是机器学习，这些其实都是为应用提供支撑，让应用更好的运维、让应用更好的呈现数据价值、让应用能够进化到自我学习等。云计算的PAAS，其实就是为应用提供多种支撑的，只是由于多种因素，PAAS一直不温不火。。直到容器的出现，容器是为应用而生，更进一步说，容器是云时代的应用载体。</p>
<p>，</p>

                

                <hr>
                <!-- Pager -->
                <ul class="pager">
                    
                        <li class="previous">
                            <a href="/2020/09/11/cuda与driver版本关系/" data-toggle="tooltip" data-placement="top" title="cuda与driver版本关系">&larr; 上一篇</a>
                        </li>
                    
                    
                        <li class="next">
                            <a href="/2020/09/04/容器内Tomcat的JVM内存配置/" data-toggle="tooltip" data-placement="top" title="容器内Tomcat的JVM内存配置">下一篇 &rarr;</a>
                        </li>
                    
                </ul>

                <br>

                <!--打赏-->
                
                <!--打赏-->

                <br>
                <!--分享-->
                
                    <div class="social-share"  data-wechat-qrcode-helper="" align="center"></div>
                    <!--  css & js -->
                    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/social-share.js/1.0.16/css/share.min.css">
                    <script src="https://cdnjs.cloudflare.com/ajax/libs/social-share.js/1.0.16/js/social-share.min.js"></script>
                
                <!--分享-->
                <br>                       
                
                <!-- require APlayer -->
                

                <!-- disqus comment start -->
                
                <!-- disqus comment end -->

                
				
            </div>

            <!-- Tabe of Content -->
            <!-- Table of Contents -->

                
            <!-- Sidebar Container -->
            <div class="
                col-lg-8 col-lg-offset-2
                col-md-10 col-md-offset-1
                sidebar-container">

                <!-- Featured Tags -->
                
                <section>
                    <!-- no hr -->
                    <h5><a href="/tags/">标签云</a></h5>
                    <div class="tags">
                       
                    </div>
                </section>
                

                <!-- Friends Blog -->
                
                <hr>
                <h5>FRIENDS</h5>
                <ul class="list-inline">

                    
                        <li><a href="http://www.sumoon.com" target="_blank">ACE theme</a></li>
                    
                </ul>
                
            </div>
        </div>
    </div>
</article>






<!-- async load function -->
<script>
    function async(u, c) {
      var d = document, t = 'script',
          o = d.createElement(t),
          s = d.getElementsByTagName(t)[0];
      o.src = u;
      if (c) { o.addEventListener('load', function (e) { c(null, e); }, false); }
      s.parentNode.insertBefore(o, s);
    }
</script>
<!-- anchor-js, Doc:http://bryanbraun.github.io/anchorjs/ -->
<script>
    async("https://cdn.bootcss.com/anchor-js/1.1.1/anchor.min.js",function(){
        anchors.options = {
          visible: 'hover',
          placement: 'left',
          icon: 'ℬ'
        };
        anchors.add().remove('.intro-header h1').remove('.subheading').remove('.sidebar-container h5');
    })
</script>
<style>
    /* place left on bigger screen */
    @media all and (min-width: 800px) {
        .anchorjs-link{
            position: absolute;
            left: -0.75em;
            font-size: 1.1em;
            margin-top : -0.1em;
        }
    }
</style>



    <!-- Footer -->
    <!-- Footer -->
<footer>
    <div class="container">
        <div class="row">
            <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
                <ul class="list-inline text-center">
                
                
                

                

                

                
                    <li>
                        <a target="_blank"  href="https://github.com/davidstack">
                            <span class="fa-stack fa-lg">
                                <i class="fa fa-circle fa-stack-2x"></i>
                                <i class="fa fa-github fa-stack-1x fa-inverse"></i>
                            </span>
                        </a>
                    </li>
                

                

                </ul>
                <p class="copyright text-muted">
                    Copyright &copy; 站着工程师 2020 
                    <br>
                    Powered by <a target="_blank" rel="noopener" href="http://www.hexo.io">Hexo</a> 
                    <span style="display: inline-block; margin: 0 5px;">
                        <i class="fa fa-heart"></i>
                    </span> 
                    Theme by <a target="_blank" rel="noopener" href="https://github.com/kinggozhang/hexo-theme-ace">ACE</a> 
					
					
					<i class="fa fa-eye" id="leancounter"></i>
					
					  <div class="copyright text-muted">
                        <script async src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>
                        本站总访问量 <span id="busuanzi_value_site_pv"></span> 次
                        本站访客数<span id="busuanzi_value_site_uv"></span>人
                      </div>
                </p>
            </div>
        </div>
    </div>
</footer>

<!-- jQuery -->

   
<script src="https://cdn.staticfile.org/jquery/2.2.4/jquery.min.js"></script>




<!-- Bootstrap Core JavaScript -->

   
<script src="https://cdn.staticfile.org/twitter-bootstrap/3.4.1/js/bootstrap.min.js"></script>



<!-- Custom Theme JavaScript -->

<script src="/js/hux-blog.min.js"></script>



	
<script src="/js/particles.js"></script>

	
<script src="/js/particles_config.js"></script>




<!-- async load function -->
<script>
    function async(u, c) {
      var d = document, t = 'script',
          o = d.createElement(t),
          s = d.getElementsByTagName(t)[0];
      o.src = u;
      if (c) { o.addEventListener('load', function (e) { c(null, e); }, false); }
      s.parentNode.insertBefore(o, s);
    }
</script>

<!-- 
     Because of the native support for backtick-style fenced code blocks 
     right within the Markdown is landed in Github Pages, 
     From V1.6, There is no need for Highlight.js, 
     so Huxblog drops it officially.

     - https://github.com/blog/2100-github-pages-now-faster-and-simpler-with-jekyll-3-0  
     - https://help.github.com/articles/creating-and-highlighting-code-blocks/    
-->
<!--
    <script>
        async("http://cdn.bootcss.com/highlight.js/8.6/highlight.min.js", function(){
            hljs.initHighlightingOnLoad();
        })
    </script>
    <link href="http://cdn.bootcss.com/highlight.js/8.6/styles/github.min.css" rel="stylesheet">
-->


<!-- jquery.tagcloud.js -->
<script>
    // only load tagcloud.js in tag.html
    if($('#tag_cloud').length !== 0){
        async("http://damonyi.cc/2020/09/08/%E8%B0%88Docker%E5%AE%B9%E5%99%A8/index.html/js/jquery.tagcloud.js",function(){
            $.fn.tagcloud.defaults = {
                //size: {start: 1, end: 1, unit: 'em'},
                color: {start: '#bbbbee', end: '#0085a1'},
            };
            $('#tag_cloud a').tagcloud();
        })
    }
</script>

<!--fastClick.js -->
<script>
    async("https://cdn.bootcss.com/fastclick/1.0.6/fastclick.min.js", function(){
        var $nav = document.querySelector("nav");
        if($nav) FastClick.attach($nav);
    })
</script>


<!-- Google Analytics -->




<!-- Baidu Tongji -->

<script async src="//dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js">
</script>
<span id="busuanzi_container_site_pv">
    本站总访问量<span id="busuanzi_value_site_pv"></span>次
</span>




	<a id="rocket" href="#top" class=""></a>
	<script type="text/javascript" src="/js/totop.js?v=1.0.0" async=""></script>
    <script type="text/javascript" src="/js/toc.js?v=1.0.0" async=""></script>
<!-- Image to hack wechat -->
<img src="http://damonyi.cc/img/icon_wechat.png" width="0" height="0" />
<!-- Migrate from head to bottom, no longer block render and still work -->

</body>

</html>
